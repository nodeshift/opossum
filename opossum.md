<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [CircuitBreaker][1]
    *   [Parameters][2]
    *   [close][3]
    *   [open][4]
    *   [shutdown][5]
    *   [isShutdown][6]
    *   [name][7]
    *   [group][8]
    *   [pendingClose][9]
    *   [closed][10]
    *   [opened][11]
    *   [halfOpen][12]
    *   [status][13]
    *   [stats][14]
    *   [enabled][15]
    *   [warmUp][16]
    *   [volumeThreshold][17]
    *   [fallback][18]
        *   [Parameters][19]
    *   [fire][20]
        *   [Parameters][21]
    *   [call][22]
        *   [Parameters][23]
    *   [clearCache][24]
    *   [healthCheck][25]
        *   [Parameters][26]
    *   [enable][27]
    *   [disable][28]
    *   [isOurError][29]
        *   [Parameters][30]
    *   [newStatus][31]
        *   [Parameters][32]
*   [CircuitBreaker#halfOpen][33]
*   [CircuitBreaker#close][34]
*   [CircuitBreaker#open][35]
*   [CircuitBreaker#shutdown][36]
*   [CircuitBreaker#fire][37]
*   [CircuitBreaker#cacheHit][38]
*   [CircuitBreaker#cacheMiss][39]
*   [CircuitBreaker#reject][40]
*   [CircuitBreaker#timeout][41]
*   [CircuitBreaker#success][42]
*   [CircuitBreaker#semaphoreLocked][43]
*   [CircuitBreaker#healthCheckFailed][44]
*   [CircuitBreaker#fallback][45]
*   [CircuitBreaker#failure][46]
*   [Status][47]
    *   [Parameters][48]
    *   [Examples][49]
    *   [stats][50]
    *   [window][51]
*   [Status#snapshot][52]
*   [MemoryCache][53]
    *   [Properties][54]
    *   [get][55]
        *   [Parameters][56]
    *   [set][57]
        *   [Parameters][58]
    *   [flush][59]

## CircuitBreaker

**Extends EventEmitter**

Constructs a [CircuitBreaker][1].

### Parameters

*   `action` **[Function][60]** The action to fire for this [CircuitBreaker][1]
*   `options` **[Object][61]** Options for the [CircuitBreaker][1]

    *   `options.status` **[Status][13]** A [Status][13] object that might
        have pre-prime stats
    *   `options.timeout` **[Number][62]** The time in milliseconds that action should
        be allowed to execute before timing out. Timeout can be disabled by setting
        this to `false`. Default 10000 (10 seconds)
    *   `options.maxFailures` **[Number][62]** (Deprecated) The number of times the
        circuit can fail before opening. Default 10.
    *   `options.resetTimeout` **[Number][62]** The time in milliseconds to wait before
        setting the breaker to `halfOpen` state, and trying the action again.
        Default: 30000 (30 seconds)
    *   `options.rollingCountTimeout` **[Number][62]** Sets the duration of the
        statistical rolling window, in milliseconds. This is how long Opossum keeps
        metrics for the circuit breaker to use and for publishing. Default: 10000
    *   `options.rollingCountBuckets` **[Number][62]** Sets the number of buckets the
        rolling statistical window is divided into. So, if
        options.rollingCountTimeout is 10000, and options.rollingCountBuckets is 10,
        then the statistical window will be 1000/1 second snapshots in the
        statistical window. Default: 10
    *   `options.name` **[String][63]** the circuit name to use when reporting stats.
        Default: the name of the function this circuit controls.
    *   `options.rollingPercentilesEnabled` **[boolean][64]** This property indicates
        whether execution latencies should be tracked and calculated as percentiles.
        If they are disabled, all summary statistics (mean, percentiles) are
        returned as -1. Default: true
    *   `options.capacity` **[Number][62]** the number of concurrent requests allowed.
        If the number currently executing function calls is equal to
        options.capacity, further calls to `fire()` are rejected until at least one
        of the current requests completes. Default: `Number.MAX_SAFE_INTEGER`.
    *   `options.errorThresholdPercentage` **[Number][62]** the error percentage at
        which to open the circuit and start short-circuiting requests to fallback.
        Default: 50
    *   `options.enabled` **[boolean][64]** whether this circuit is enabled upon
        construction. Default: true
    *   `options.allowWarmUp` **[boolean][64]** determines whether to allow failures
        without opening the circuit during a brief warmup period (this is the
        `rollingCountTimeout` property). Default: false
        This can help in situations where no matter what your
        `errorThresholdPercentage` is, if the first execution times out or fails,
        the circuit immediately opens.
    *   `options.volumeThreshold` **[Number][62]** the minimum number of requests within
        the rolling statistical window that must exist before the circuit breaker
        can open. This is similar to `options.allowWarmUp` in that no matter how many
        failures there are, if the number of requests within the statistical window
        does not exceed this threshold, the circuit will remain closed. Default: 0
    *   `options.errorFilter` **[Function][60]** an optional function that will be
        called when the circuit's function fails (returns a rejected Promise). If
        this function returns truthy, the circuit's failPure statistics will not be
        incremented. This is useful, for example, when you don't want HTTP 404 to
        trip the circuit, but still want to handle it as a failure case.
    *   `options.cache` **[boolean][64]** whether the return value of the first
        successful execution of the circuit's function will be cached. Once a value
        has been cached that value will be returned for every subsequent execution:
        the cache can be cleared using `clearCache`. (The metrics `cacheHit` and
        `cacheMiss` reflect cache activity.) Default: false
    *   `options.cacheTTL` **[Number][62]** the time to live for the cache
        in milliseconds. Set 0 for infinity cache. Default: 0 (no TTL)
    *   `options.cacheGetKey` **[Function][60]** function that returns the key to use
        when caching the result of the circuit's fire.
        Better to use custom one, because `JSON.stringify` is not good
        from performance perspective.
        Default: `(...args) => JSON.stringify(args)`
    *   `options.cacheTransport` **CacheTransport** custom cache transport
        should implement `get`, `set` and `flush` methods.
    *   `options.abortController` **AbortController** this allows Opossum to
        signal upon timeout and properly abort your on going requests instead of
        leaving it in the background
    *   `options.enableSnapshots` **[boolean][64]** whether to enable the rolling
        stats snapshots that opossum emits at the bucketInterval. Disable this
        as an optimization if you don't listen to the 'snapshot' event to reduce
        the number of timers opossum initiates.
    *   `options.rotateBucketController` **EventEmitter** if you have multiple
        breakers in your app, the number of timers across breakers can get costly.
        This option allows you to provide an EventEmitter that rotates the buckets
        so you can have one global timer in your app. Make sure that you are
        emitting a 'rotate' event from this EventEmitter

### close

Closes the breaker, allowing the action to execute again

Returns **void**&#x20;

### open

Opens the breaker. Each time the breaker is fired while the circuit is
opened, a failed Promise is returned, or if any fallback function
has been provided, it is invoked.

If the breaker is already open this call does nothing.

Returns **void**&#x20;

### shutdown

Shuts down this circuit breaker. All subsequent calls to the
circuit will fail, returning a rejected promise.

Returns **void**&#x20;

### isShutdown

Determines if the circuit has been shutdown.

Type: [Boolean][64]

### name

Gets the name of this circuit

Type: [String][63]

### group

Gets the name of this circuit group

Type: [String][63]

### pendingClose

Gets whether this circuit is in the `pendingClosed` state

Type: [Boolean][64]

### closed

True if the circuit is currently closed. False otherwise.

Type: [Boolean][64]

### opened

True if the circuit is currently opened. False otherwise.

Type: [Boolean][64]

### halfOpen

True if the circuit is currently half opened. False otherwise.

Type: [Boolean][64]

### status

The current [Status][13] of this [CircuitBreaker][1]

Type: [Status][13]

### stats

*   **See**: Status#stats

Get the current stats for the circuit.

Type: [Object][61]

### enabled

Gets whether the circuit is enabled or not

Type: [Boolean][64]

### warmUp

Gets whether the circuit is currently in warm up phase

Type: [Boolean][64]

### volumeThreshold

Gets the volume threshold for this circuit

Type: [Boolean][64]

### fallback

Provide a fallback function for this [CircuitBreaker][1]. This
function will be executed when the circuit is `fire`d and fails.
It will always be preceded by a `failure` event, and `breaker.fire` returns
a rejected Promise.

#### Parameters

*   `func` **([Function][60] | [CircuitBreaker][1])** the fallback function to execute
    when the breaker has opened or when a timeout or error occurs.

Returns **[CircuitBreaker][1]** this

### fire

Execute the action for this circuit. If the action fails or times out, the
returned promise will be rejected. If the action succeeds, the promise will
resolve with the resolved value from action. If a fallback function was
provided, it will be invoked in the event of any failure or timeout.

Any parameters passed to this function will be proxied to the circuit
function.

#### Parameters

*   `args` **...any**&#x20;

Returns **[Promise][65]\<any>** promise resolves with the circuit function's return
value on success or is rejected on failure of the action. Use isOurError()
to determine if a rejection was a result of the circuit breaker or the
action.

### call

Execute the action for this circuit using `context` as `this`.
If the action fails or times out, the
returned promise will be rejected. If the action succeeds, the promise will
resolve with the resolved value from action. If a fallback function was
provided, it will be invoked in the event of any failure or timeout.

Any parameters in addition to \`context will be passed to the
circuit function.

#### Parameters

*   `context` **any** the `this` context used for function execution
*   `rest` **any** the arguments passed to the action

Returns **[Promise][65]\<any>** promise resolves with the circuit function's return
value on success or is rejected on failure of the action.

### clearCache

Clears the cache of this [CircuitBreaker][1]

Returns **void**&#x20;

### healthCheck

Provide a health check function to be called periodically. The function
should return a Promise. If the promise is rejected the circuit will open.
This is in addition to the existing circuit behavior as defined by
`options.errorThresholdPercentage` in the constructor. For example, if the
health check function provided here always returns a resolved promise, the
circuit can still trip and open if there are failures exceeding the
configured threshold. The health check function is executed within the
circuit breaker's execution context, so `this` within the function is the
circuit breaker itself.

#### Parameters

*   `func` **[Function][60]** a health check function which returns a promise.
*   `interval` **[Number][62]?** the amount of time between calls to the health
    check function. Default: 5000 (5 seconds)

<!---->

*   Throws **[TypeError][66]** if `interval` is supplied but not a number

Returns **void**&#x20;

### enable

Enables this circuit. If the circuit is the  disabled
state, it will be re-enabled. If not, this is essentially
a noop.

Returns **void**&#x20;

### disable

Disables this circuit, causing all calls to the circuit's function
to be executed without circuit or fallback protection.

Returns **void**&#x20;

### isOurError

Returns true if the provided error was generated here. It will be false
if the error came from the action itself.

#### Parameters

*   `error` **[Error][67]** The Error to check.

Returns **[Boolean][64]** true if the error was generated here

### newStatus

Create a new Status object,
helpful when you need to prime a breaker with stats

#### Parameters

*   `options` **[Object][61]** *

    *   `options.rollingCountBuckets` **[Number][62]** number of buckets in the window
    *   `options.rollingCountTimeout` **[Number][62]** the duration of the window
    *   `options.rollingPercentilesEnabled` **[Boolean][64]** whether to calculate
    *   `options.stats` **[Object][61]** user supplied stats

Returns **[Status][13]** a new [Status][13] object

## CircuitBreaker#halfOpen

Emitted after `options.resetTimeout` has elapsed, allowing for
a single attempt to call the service again. If that attempt is
successful, the circuit will be closed. Otherwise it remains open.

Type: [Number][62]

## CircuitBreaker#close

Emitted when the breaker is reset allowing the action to execute again

## CircuitBreaker#open

Emitted when the breaker opens because the action has
failure percentage greater than `options.errorThresholdPercentage`.

## CircuitBreaker#shutdown

Emitted when the circuit breaker has been shut down.

## CircuitBreaker#fire

Emitted when the circuit breaker action is executed

Type: any

## CircuitBreaker#cacheHit

Emitted when the circuit breaker is using the cache
and finds a value.

## CircuitBreaker#cacheMiss

Emitted when the circuit breaker does not find a value in
the cache, but the cache option is enabled.

## CircuitBreaker#reject

Emitted when the circuit breaker is open and failing fast

Type: [Error][67]

## CircuitBreaker#timeout

Emitted when the circuit breaker action takes longer than
`options.timeout`

Type: [Error][67]

## CircuitBreaker#success

Emitted when the circuit breaker action succeeds

Type: any

## CircuitBreaker#semaphoreLocked

Emitted when the rate limit has been reached and there
are no more locks to be obtained.

Type: [Error][67]

## CircuitBreaker#healthCheckFailed

Emitted with the user-supplied health check function
returns a rejected promise.

Type: [Error][67]

## CircuitBreaker#fallback

Emitted when the circuit breaker executes a fallback function

Type: any

## CircuitBreaker#failure

Emitted when the circuit breaker action fails

Type: [Error][67]

## Status

**Extends EventEmitter**

*   **See**: CircuitBreaker#status

Tracks execution status for a given [CircuitBreaker][1].
A Status instance is created for every [CircuitBreaker][1]
and does not typically need to be created by a user.

A Status instance will listen for all events on the [CircuitBreaker][1]
and track them in a rolling statistical window. The window duration is
determined by the `rollingCountTimeout` option provided to the
[CircuitBreaker][1]. The window consists of an array of Objects,
each representing the counts for a [CircuitBreaker][1]'s events.

The array's length is determined by the [CircuitBreaker][1]'s
`rollingCountBuckets` option. The duration of each slice of the window
is determined by dividing the `rollingCountTimeout` by
`rollingCountBuckets`.

### Parameters

*   `options` **[Object][61]** for the status window

    *   `options.rollingCountBuckets` **[Number][62]** number of buckets in the window
    *   `options.rollingCountTimeout` **[Number][62]** the duration of the window
    *   `options.rollingPercentilesEnabled` **[Boolean][64]** whether to calculate
        percentiles
    *   `options.stats` **[Object][61]** object of previous stats

### Examples

```javascript
// Creates a 1 second window consisting of ten time slices,
// each 100ms long.
const circuit = circuitBreaker(fs.readFile,
 { rollingCountBuckets: 10, rollingCountTimeout: 1000});

// get the cumulative statistics for the last second
circuit.status.stats;

// get the array of 10, 1 second time slices for the last second
circuit.status.window;
```

### stats

Get the cumulative stats for the current window

Type: [Object][61]

### window

Gets the stats window as an array of time-sliced objects.

Type: [Array][68]

## Status#snapshot

Emitted at each time-slice. Listeners for this
event will receive a cumulative snapshot of the current status window.

Type: [Object][61]

## MemoryCache

Simple in-memory cache implementation

### Properties

*   `cache` **[Map][69]** Cache map

### get

Get cache value by key

#### Parameters

*   `key` **[string][63]** Cache key

Returns **any** Response from cache

### set

Set cache key with value and ttl

#### Parameters

*   `key` **[string][63]** Cache key
*   `value` **any** Value to cache
*   `ttl` **[number][62]** Time to live in milliseconds

Returns **void**&#x20;

### flush

Clear cache

Returns **void**&#x20;

[1]: #circuitbreaker

[2]: #parameters

[3]: #close

[4]: #open

[5]: #shutdown

[6]: #isshutdown

[7]: #name

[8]: #group

[9]: #pendingclose

[10]: #closed

[11]: #opened

[12]: #halfopen

[13]: #status

[14]: #stats

[15]: #enabled

[16]: #warmup

[17]: #volumethreshold

[18]: #fallback

[19]: #parameters-1

[20]: #fire

[21]: #parameters-2

[22]: #call

[23]: #parameters-3

[24]: #clearcache

[25]: #healthcheck

[26]: #parameters-4

[27]: #enable

[28]: #disable

[29]: #isourerror

[30]: #parameters-5

[31]: #newstatus

[32]: #parameters-6

[33]: #circuitbreakerhalfopen

[34]: #circuitbreakerclose

[35]: #circuitbreakeropen

[36]: #circuitbreakershutdown

[37]: #circuitbreakerfire

[38]: #circuitbreakercachehit

[39]: #circuitbreakercachemiss

[40]: #circuitbreakerreject

[41]: #circuitbreakertimeout

[42]: #circuitbreakersuccess

[43]: #circuitbreakersemaphorelocked

[44]: #circuitbreakerhealthcheckfailed

[45]: #circuitbreakerfallback

[46]: #circuitbreakerfailure

[47]: #status-1

[48]: #parameters-7

[49]: #examples

[50]: #stats-1

[51]: #window

[52]: #statussnapshot

[53]: #memorycache

[54]: #properties

[55]: #get

[56]: #parameters-8

[57]: #set

[58]: #parameters-9

[59]: #flush

[60]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[61]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[62]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[63]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[64]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[65]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[66]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/TypeError

[67]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error

[68]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[69]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map
